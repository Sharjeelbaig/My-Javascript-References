# Validating ID Tokens in Hono with Firebase Admin SDK



### 1. Install Firebase Admin SDK

```bash
npm install firebase-admin
```



### 2. Initialize Firebase Admin

Create a `firebaseAdmin.js` file (or similar):

```js
import admin from "firebase-admin";
import serviceAccount from "./serviceAccountKey.json" assert { type: "json" };
admin.initializeApp({
  credential: admin.credential.cert(serviceAccount)
});
export default admin;
```

> Make sure your `FIREBASE_PRIVATE_KEY` handles line breaks correctly (`replace(/\\n/g, "\n")`).



### 3. Create a Middleware in Hono to Validate JWT

```js
import { Hono } from "hono";
import admin from "./firebaseAdmin.js";

const app = new Hono();

async function authMiddleware(c, next) {
  const authHeader = c.req.header("Authorization");
  if (!authHeader || !authHeader.startsWith("Bearer ")) {
    return c.json({ error: "Unauthorized" }, 401);
  }

  const idToken = authHeader.split("Bearer ")[1];

  try {
    const decodedToken = await admin.auth().verifyIdToken(idToken);
    // Attach user info to context for downstream routes
    c.set("user", decodedToken);
    return next();
  } catch (err) {
    return c.json({ error: "Invalid token" }, 401);
  }
}
```



### 4. Protect Routes

```js
app.get("/protected", authMiddleware, (c) => {
  const user = c.get("user"); // decoded token
  return c.json({ message: "Hello " + user.email });
});
```

```js
app.post("/another-protected", authMiddleware, (c) => {
  const user = c.get("user"); // decoded token
  return c.json({ message: "Welcome back " + user.name });
});
```



âœ… This setup lets you:

* Verify Firebase ID tokens from frontend.
* Access user info (`uid`, `email`, `name`) in your Hono routes.
* Protect any route by adding the middleware.
