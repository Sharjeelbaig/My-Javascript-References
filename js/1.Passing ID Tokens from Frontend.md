# Passing ID Tokens from Frontend (Firebase)

This document explains how to obtain a Firebase ID token from the frontend (browser or SPA) and pass it to your backend as an `Authorization` header so it can be validated.



## 1. Sign in and Get the ID Token

Install the Firebase client SDK in your frontend project (if not done already):

```bash
npm install firebase@9 --save
```

Initialize Firebase in your app (one-time setup):

```js
// firebaseClient.js
import { initializeApp } from "firebase/app";
import { getAuth, signInWithEmailAndPassword } from "firebase/auth";

const firebaseConfig = {
  apiKey: import.meta.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.VITE_FIREBASE_STORGAE_BUCKET,
  messagingSenderId: import.meta.VITE_FIREBASE_MESSEGING_SENDER_ID,
  appId: import.meta.VITE_FIREBASE_APP_ID,
  measurementId: import.meta.VITE_FIREBASE_MEASUREMENT_ID
};

const app = initializeApp(firebaseConfig);
export const auth = getAuth(app);
```

Sign-in and get the ID token:

```js
import { auth } from "./firebaseClient";
import { signInWithEmailAndPassword } from "firebase/auth";

async function signIn(email, password) {
  const userCredential = await signInWithEmailAndPassword(auth, email, password);
  const user = userCredential.user;
  // Get the ID token (JWT)
  const idToken = await user.getIdToken(/* forceRefresh = */ true);
  return idToken;
}
```

Alternatively, obtain the ID token from the currently signed-in user:

```js
import { onAuthStateChanged } from "firebase/auth";

onAuthStateChanged(auth, async (user) => {
  if (user) {
    const idToken = await user.getIdToken();
    // Use the idToken in requests
  }
});
```

By the way, you can also signin with google, facebook, etc, for example:

```js
import { GoogleAuthProvider, signInWithPopup } from "firebase/auth";
const provider = new GoogleAuthProvider();
const result = await signInWithPopup(auth, provider);
const user = result.user;
const idToken = await user.getIdToken();
```

```js
  async function signInWithGoogle() {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;
    const idToken = await user.getIdToken();
    return idToken;
  }
```



## 2. Send the ID Token to Backend

Attach the ID token to HTTP requests using the `Authorization: Bearer <token>` header. Below are a few examples.

### Fetch

```js
async function fetchProtected(resourceUrl, idToken, body) {
  const res = await fetch(resourceUrl, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${idToken}`,
    },
    body: JSON.stringify(body),
  });
  return res.json();
}
```

### Axios

```js
import axios from "axios";

async function postWithToken(url, idToken, data) {
  const res = await axios.post(url, data, {
    headers: {
      Authorization: `Bearer ${idToken}`,
    },
  });
  return res.data;
}
```

```js
import axios from "axios";
async function getWithToken(url, idToken) {
  const res = await axios.get(url, {
    headers: {
      Authorization: `Bearer ${idToken}`,
    },
  });
  return res.data;
}
```

### Adding the token automatically via an interceptor

```js
axios.interceptors.request.use(async config => {
  const user = auth.currentUser;
  if (user) {
    const idToken = await user.getIdToken();
    config.headers = config.headers || {};
    config.headers.Authorization = `Bearer ${idToken}`;
  }
  return config;
});
```



## 3. Good Practices

- Use short-lived tokens and refresh them as needed (Firebase ID tokens expire, refresh automatically via the SDK).
- Securely store any non-token state (e.g., in-memory or secure cookies), don't persist the ID token anywhere long-term on the client.
- Use HTTPS to protect the token in transit.
- For additional CSRF protections, prefer sending the ID token via `Authorization` header instead of cookies unless you implement proper cookie security.



## 4. Example: Frontend + Hono Backend Request

- Frontend: calls `await fetch('/api/protected', { headers: { Authorization: `Bearer ${idToken}` } })`.
- Backend: validates the ID token using Firebase Admin SDK (see `3.Validating ID Tokens.md`).



## 5. Troubleshooting

- If you receive `Unauthorized` or `Invalid token`, ensure that:
  - The frontend attaches the token as `Bearer <idToken>` in `Authorization` header.
  - The backend is using a valid Firebase Admin SDK configuration and the token is not expired.
  - The `FIREBASE_PRIVATE_KEY` and other environment variables are set and correctly formatted with `\\n` line breaks.

Happy coding! âœ…
